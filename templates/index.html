{% extends 'base.html' %}
{% block title %}Accueil — Examhub{% endblock %}

{% block content %}
  <h1 class="text-3xl font-bold mb-2">Téléchargez des packs épreuves d’examen + corrigés</h1>
  <h2 class="text-xl text-gray-600 mb-4">Liste des examens pris en charge</h2>

  <!-- Barre de recherche -->
  <div class="mb-6">
    <input
      id="exam-search"
      name="q"
      type="search"
      value="{{ q|default:'' }}"
      placeholder="Rechercher un examen (ex. : BAC, BEPC, …)"
      class="w-full rounded-2xl border border-gray-300 bg-white px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500"
      autocomplete="off"
    />
    <p class="text-xs text-gray-500 mt-1">Tapez pour rechercher — les résultats s’actualisent automatiquement.</p>
  </div>

  <!-- Résultats -->
  <div id="exam-results">
    {% include "partials/exam_cards.html" with exams=exams %}
  </div>
{% endblock %}

{% block scripts %}
<script>
(function () {
  const input = document.getElementById('exam-search');
  const results = document.getElementById('exam-results');
  let controller = null;

  function update() {
    const q = input.value.trim();
    const url = "{% url 'exams:index' %}?q=" + encodeURIComponent(q);
    if (controller) controller.abort();
    controller = new AbortController();
    fetch(url, {
      headers: { 'X-Requested-With': 'XMLHttpRequest' },
      signal: controller.signal
    })
      .then(r => r.text())
      .then(html => { results.innerHTML = html; })
      .catch(() => {});
  }

  input.addEventListener('input', update);
})();
</script>
{% endblock %}
