{% extends 'base.html' %}
{% block title %}Mes notifications — Examhub{% endblock %}
{% block content %}
<p class="mb-4">
  <a href="{% url 'exams:index' %}" class="text-blue-600 hover:underline">← Retourner à l’accueil</a>
</p>
<h1 class="text-2xl font-bold mb-4">Mes notifications</h1>

{% if notifications %}
  <div class="flex flex-wrap gap-2 mb-4">
    <a href="{% url 'exams:notifications_mark_all_read' %}"
       class="px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
      Marquer toutes comme lues
    </a>
    <a href="{% url 'exams:notifications_delete_all' %}"
       class="px-3 py-2 rounded bg-red-600 text-white hover:bg-red-700"
       onclick="return confirm('Supprimer toutes les notifications ?');">
      Supprimer toutes les notifications
    </a>
  </div>
{% endif %}

{% if not notifications %}
  <div class="bg-white rounded-2xl shadow p-5">Aucune notification.</div>
{% else %}
  <div class="bg-white rounded-2xl shadow divide-y">
    {% for n in notifications %}
      <div class="p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between {% if not n.read %}bg-yellow-50{% endif %}">
        <div class="space-y-2">
          <div class="font-medium">{{ n.message }}</div>

          {# Affichage optionnel des packs transmis dans le payload de la notif #}
          {% if n.payload.packs %}
            <ul class="list-disc pl-5 space-y-1">
              {% for p in n.payload.packs %}
                <li class="flex items-center gap-3">
                  <span>{{ p.name }}</span>
                  {% if p.price %}<span class="text-xs text-gray-500">{{ p.price }} F</span>{% endif %}
                  {% if p.download_url %}
                    <a class="px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700"
                      href="{{ p.download_url }}">
                      Télécharger ZIP
                    </a>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% endif %}

          <div class="text-xs text-gray-500">{{ n.created_at|date:"d/m/Y H:i" }}</div>
        </div>
        <div class="mt-3 sm:mt-0 flex gap-2">
          {% if not n.read %}
            <a class="px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700"
               href="{% url 'exams:notifications_mark_read' n.pk %}">
              Marquer comme lue
            </a>
          {% endif %}
          <a class="px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700"
             href="{% url 'exams:notifications_delete' n.pk %}"
             onclick="return confirm('Supprimer cette notification ?');">
            Supprimer
          </a>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}
